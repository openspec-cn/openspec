# cli-view 规范

## 目的

`openspec view` 命令提供 OpenSpec 项目状态的综合仪表板视图，以统一、视觉上吸引人的格式显示规范、变更和进度指标，以帮助开发人员快速了解项目状态。

## 需求
### 需求：仪表板显示

系统必须提供一个 `view` 命令，用于显示规范和变更的仪表板概览。

#### 场景：基本仪表板显示

- **当** 用户运行 `openspec view` 时
- **那么** 系统显示格式化的仪表板，其中包含摘要、活动变更、已完成变更和规范部分

#### 场景：无 OpenSpec 目录

- **当** 用户在没有 OpenSpec 的目录中运行 `openspec view` 时
- **那么** 系统显示错误消息 "✗ No openspec directory found"（未找到 openspec 目录）

### 需求：摘要部分

仪表板必须显示带有关键项目指标的摘要部分，包括草稿变更计数。

#### 场景：完整摘要显示

- **当** 仪表板随规范和变更一起渲染时
- **那么** 系统显示规范和需求的总数
- **并且** 显示草稿变更的数量
- **并且** 显示正在进行的活动变更的数量
- **并且** 显示已完成变更的数量
- **并且** 显示总体任务进度百分比

#### 场景：空项目摘要

- **当** 不存在规范或变更时
- **那么** 摘要显示所有指标的计数为零

### 需求：活动变更显示
仪表板必须显示带有视觉进度指示器的活动变更。

#### 场景：按完成百分比排序的活动变更
- **当** 显示多个带有进度信息的活动变更时
- **那么** 按完成百分比升序排列它们，以便 0% 的项目首先出现
- **并且** 将缺失的进度值视为 0% 进行排序
- **并且** 按变更标识符的升序字母顺序打破平局，以保持输出确定性

### 需求：已完成变更显示

仪表板必须在单独的部分中列出已完成的变更，仅显示所有任务都已完成的变更。

> **修复 bug**：以前，`total === 0` 的变更被错误地显示为已完成。

#### 场景：已完成变更列表

- **当** 存在 `tasks.total > 0` 且 `tasks.completed === tasks.total` 的变更时
- **那么** 系统在专用部分中用复选标记指示器显示它们

#### 场景：混合完成状态

- **当** 一些变更已完成而其他变更处于活动状态时
- **那么** 系统将它们分隔到适当的部分

#### 场景：空变更未完成

- **当** 变更没有 tasks.md 或定义的任务为零时
- **那么** 系统**不**在 "Completed Changes"（已完成变更）部分显示它
- **并且** 改为在 "Draft Changes"（草稿变更）部分显示它

### 需求：规范显示

仪表板必须按需求计数对规范进行排序显示。

#### 场景：带计数的规范列表

- **当** 项目中存在规范时
- **那么** 系统按需求计数（降序）显示规范并带有计数标签

#### 场景：带解析错误的规范

- **当** 无法解析规范文件时
- **那么** 系统包含它，且需求计数为 0

### 需求：视觉格式化

仪表板必须使用一致的视觉格式以及颜色和符号。

#### 场景：颜色编码

- **当** 显示仪表板元素时
- **那么** 系统对规范项目使用青色
- **并且** 对活动变更使用黄色
- **并且** 对已完成项目使用绿色
- **并且** 对补充文本使用暗灰色

#### 场景：进度条渲染

- **当** 显示进度条时
- **那么** 系统对已完成部分使用实心块 (█)，对剩余部分使用浅色块 (░)

### 需求：错误处理

view 命令必须优雅地处理错误。

#### 场景：文件系统错误

- **当** 文件系统操作失败时
- **那么** 系统继续使用可用数据并省略无法访问的项目

#### 场景：无效数据结构

- **当** 规范或变更具有无效格式时
- **那么** 系统跳过无效项目并继续渲染

### 需求：草稿变更显示

仪表板必须在单独的 "Draft"（草稿）部分显示没有任务的变更。

#### 场景：草稿变更列表

- **当** 存在没有 tasks.md 或定义的任务为零的变更时
- **那么** 系统在 "Draft Changes" 部分显示它们
- **并且** 使用独特的指示器（例如，`○`）显示草稿状态

#### 场景：草稿部分排序

- **当** 存在多个草稿变更时
- **那么** 系统按名称的字母顺序对它们进行排序
