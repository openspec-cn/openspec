# List 命令规范

## 目的

`openspec list` 命令必须为开发人员提供项目中所有活动变更的快速概览，显示其名称和任务完成状态。

## 需求
### 需求：命令执行
该命令必须根据选定的模式扫描并分析活动变更或规范。

#### 场景：扫描变更（默认）
- **当** 执行 `openspec list` 且不带标志时
- **那么** 扫描 `openspec/changes/` 目录以查找变更目录
- **并且** 从结果中排除 `archive/` 子目录
- **并且** 解析每个变更的 `tasks.md` 文件以统计任务完成情况

#### 场景：扫描规范
- **当** 执行 `openspec list --specs` 时
- **那么** 扫描 `openspec/specs/` 目录以查找功能
- **并且** 读取每个功能的 `spec.md`
- **并且** 解析需求以计算需求计数

### 需求：任务计数

该命令必须使用标准 markdown 复选框模式准确统计任务完成状态。

#### 场景：在 tasks.md 中统计任务

- **当** 解析 `tasks.md` 文件时
- **那么** 统计匹配以下模式的任务：
  - 已完成：包含 `- [x]` 的行
  - 未完成：包含 `- [ ]` 的行
- **并且** 计算总任务数为已完成和未完成之和

### 需求：输出格式
该命令必须以清晰、可读的表格格式显示项目，并显示适合模式的进度或计数。

#### 场景：显示变更列表（默认）
- **当** 显示变更列表时
- **那么** 显示包含以下列的表格：
  - 变更名称（目录名称）
  - 任务进度（例如，"3/5 tasks" 或 "✓ Complete"）

#### 场景：显示规范列表
- **当** 显示规范列表时
- **那么** 显示包含以下列的表格：
  - 规范 id（目录名称）
  - 需求计数（例如，"requirements 12"）

### 需求：标志
该命令必须接受标志以选择要列出的名词。

#### 场景：选择规范
- **当** 提供 `--specs` 时
- **那么** 列出规范而不是变更

#### 场景：选择变更
- **当** 提供 `--changes` 时
- **那么** 显式列出变更（与默认行为相同）

### 需求：空状态
当所选模式不存在任何项目时，该命令必须提供清晰的反馈。

#### 场景：处理空状态（变更）
- **当** 不存在活动变更（仅 archive/ 或空的 changes/）时
- **那么** 显示："No active changes found."（未找到活动变更。）

#### 场景：处理空状态（规范）
- **当** 规范目录不存在或不包含任何功能时
- **那么** 显示："No specs found."（未找到规范。）

### 需求：错误处理

该命令必须通过适当的消息优雅地处理丢失的文件和目录。

#### 场景：丢失 tasks.md 文件

- **当** 变更目录没有 `tasks.md` 文件时
- **那么** 显示状态为 "No tasks"（无任务）的变更

#### 场景：丢失 changes 目录

- **当** `openspec/changes/` 目录不存在时
- **那么** 显示错误："No OpenSpec changes directory found. Run 'openspec init' first."（未找到 OpenSpec changes 目录。请先运行 'openspec init'。）
- **并且** 以代码 1 退出

### 需求：排序

该命令必须保持变更的一致顺序，以便输出可预测。

#### 场景：变更排序

- **当** 显示多个变更时
- **那么** 按变更名称的字母顺序对它们进行排序

## 原因

开发人员需要一种快速的方法来：
- 查看正在进行的变更
- 识别哪些变更已准备好归档
- 了解整个项目的演进状态
- 在不打开多个文件的情况下获得概览

此命令以最小的努力提供了这种可见性，遵循 OpenSpec 的简单和清晰的理念。
